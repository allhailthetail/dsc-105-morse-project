#+title: Main File - Morse Project
#+startup: indent overview hideblocks entitiespretty
#+PROPERTY: header-args:R :session *R* :results output

* Prerequisites
- [[file:functions.org][Supporting Functions]]

- *Configure the working directory:*
  #+begin_quote
  The project is assuming that R's working directory is the repository root. For simplicity, I set this up
  as an environment variable on my system, ~MORSE_ROOT~ and pointed R that as shown...
  #+end_quote

  #+begin_src R :results silent
# Get and set the working directory:
Sys.getenv("MORSE_ROOT") -> projectRoot
setwd(projectRoot)
getwd()
  #+end_src

- The following dependencies need to be installed so that the audio processing can take place:
  #+name: imports
  #+begin_src R :results silent
library(sonicscrewdriver)
library(tuneR)
source("R/project_functions.R")
  #+end_src

* Step 1: Exploratory Data Analysis:
- First, let's see how many files we're going to process and get some basic information about them:
  #+begin_src R
"./data" -> audio_files_path
list.files(audio_files_path,
           full.names=TRUE) -> audio_files # this is a vec of all our audio files

length(audio_files) # number of files to analyze...
  #+end_src

  #+RESULTS:
  : [1] 200

- Gathering basic metadata:
  #+begin_src R
basic_metadata <- wav_metadata_multi(audio_files)

summary(basic_metadata)

head(basic_metadata,2)
  #+end_src

  #+RESULTS:
  #+begin_example
  filename            samples          duration        sampleRate     stereo          pcm             bitdepth
   Length:200         Min.   : 37327   Min.   : 4.666   Min.   :8000   Mode :logical   Mode:logical   Min.   :32
   Class :character   1st Qu.: 53932   1st Qu.: 6.742   1st Qu.:8000   FALSE:200       TRUE:200       1st Qu.:32
   Mode  :character   Median : 73026   Median : 9.129   Median :8000                                  Median :32
                      Mean   : 86519   Mean   :10.815   Mean   :8000                                  Mean   :32
                      3rd Qu.:105775   3rd Qu.:13.222   3rd Qu.:8000                                  3rd Qu.:32
                      Max.   :216967   Max.   :27.121   Max.   :8000                                  Max.   :32
  filename samples duration sampleRate stereo  pcm bitdepth
  1 ./data/cw001.wav  139046   17.381       8000  FALSE TRUE       32
  2 ./data/cw002.wav   92953   11.619       8000  FALSE TRUE       32
  #+end_example

  #+begin_quote
  - So, there's not a lot to see, but already we can draw some conclusions:
    1. We're dealing with approximately 36 minutes worth of data in total.
    2. All of it is mono audio, so we don't need to average the two channels
    3. There are more samples per file than would be efficient to graph as individual points,
       Luckily, tuneR has a special plot function that handles this...
  #+end_quote

- Filling in Known Predictions:
  - Handy Regex: (\d+),\s*(\w*) -> basic_metadata$prediction[\1] <- "\2"
  #+names: metadata - add predictions
  #+begin_src R :results silent
basic_metadata$prediction[1] <- ""
basic_metadata$prediction[2] <- ""
basic_metadata$prediction[3] <- ""
basic_metadata$prediction[4] <- ""
basic_metadata$prediction[5] <- "FEFOFQUHYNZ3WONZRETF"
basic_metadata$prediction[6] <- ""
basic_metadata$prediction[7] <- ""
basic_metadata$prediction[8] <- ""
basic_metadata$prediction[9] <- "5NITCM6O7M3VYTFUOLGB"
basic_metadata$prediction[10] <- ""
basic_metadata$prediction[11] <- ""
basic_metadata$prediction[12] <- ""
basic_metadata$prediction[13] <- ""
basic_metadata$prediction[14] <- ""
basic_metadata$prediction[15] <- ""
basic_metadata$prediction[16] <- ""
basic_metadata$prediction[17] <- ""
basic_metadata$prediction[18] <- "NPAIUS139K2A5T2IQZY9"
basic_metadata$prediction[19] <- ""
basic_metadata$prediction[20] <- ""
basic_metadata$prediction[21] <- ""
basic_metadata$prediction[22] <- "TF5E6V73PCP3C18OQIQ8"
basic_metadata$prediction[23] <- ""
basic_metadata$prediction[24] <- ""
basic_metadata$prediction[25] <- "YQ4CBEH852FAR5AGTBS2"
basic_metadata$prediction[26] <- "AVXDKKCKEB1EX8QABF7C"
basic_metadata$prediction[27] <- "63BTNYH7OJ7XKBNYOV49"
basic_metadata$prediction[28] <- "LGYI857RG7FXVFVGB7E3"
basic_metadata$prediction[29] <- ""
basic_metadata$prediction[30] <- ""
basic_metadata$prediction[31] <- ""
basic_metadata$prediction[32] <- ""
basic_metadata$prediction[33] <- ""
basic_metadata$prediction[34] <- ""
basic_metadata$prediction[35] <- "8BKR52AIQ3SPVHAM2T2C"
basic_metadata$prediction[36] <- ""
basic_metadata$prediction[37] <- "R2DX08BDJE46A0NU6ZT3"
basic_metadata$prediction[38] <- ""
basic_metadata$prediction[39] <- ""
basic_metadata$prediction[40] <- ""
basic_metadata$prediction[41] <- "N5DAV420EZMYJ86MM2RF"
basic_metadata$prediction[42] <- ""
basic_metadata$prediction[43] <- ""
basic_metadata$prediction[44] <- "BCYCKRK4YC1ACGOQ1771"
basic_metadata$prediction[45] <- "89E536S85K7696K4824L"
basic_metadata$prediction[46] <- ""
basic_metadata$prediction[47] <- "EZRXQHXYJZ4AIZ15AFFM"
basic_metadata$prediction[48] <- ""
basic_metadata$prediction[49] <- "GWII2VNNDB5U74ZPYUUC"
basic_metadata$prediction[50] <- "7KYQ1KSW9U7KWW9BW9CD"
basic_metadata$prediction[51] <- ""
basic_metadata$prediction[52] <- ""
basic_metadata$prediction[53] <- "ET98RNOX26UAX013JLES"
basic_metadata$prediction[54] <- ""
basic_metadata$prediction[55] <- ""
basic_metadata$prediction[56] <- ""
basic_metadata$prediction[57] <- ""
basic_metadata$prediction[58] <- ""
basic_metadata$prediction[59] <- ""
basic_metadata$prediction[60] <- ""
basic_metadata$prediction[61] <- ""
basic_metadata$prediction[62] <- "YWBRAOI6HLSTYKMIFQ8E"
basic_metadata$prediction[63] <- ""
basic_metadata$prediction[64] <- ""
basic_metadata$prediction[65] <- ""
basic_metadata$prediction[66] <- ""
basic_metadata$prediction[67] <- ""
basic_metadata$prediction[68] <- ""
basic_metadata$prediction[69] <- ""
basic_metadata$prediction[70] <- ""
basic_metadata$prediction[71] <- "GKYGS8K1MQCHD15NCV9H"
basic_metadata$prediction[72] <- "SIJP60T90447282IAP0G"
basic_metadata$prediction[73] <- ""
basic_metadata$prediction[74] <- "K7OOLNPK60WUC5PC6L0X"
basic_metadata$prediction[75] <- ""
basic_metadata$prediction[76] <- "KWOA6I12TE85P59HY272"
basic_metadata$prediction[77] <- ""
basic_metadata$prediction[78] <- ""
basic_metadata$prediction[79] <- ""
basic_metadata$prediction[80] <- ""
basic_metadata$prediction[81] <- ""
basic_metadata$prediction[82] <- "B9MBJBCG088X5HEQFYBP"
basic_metadata$prediction[83] <- ""
basic_metadata$prediction[84] <- "VS7FCHNSK6UBYHBG7Q6A"
basic_metadata$prediction[85] <- ""
basic_metadata$prediction[86] <- ""
basic_metadata$prediction[87] <- ""
basic_metadata$prediction[88] <- ""
basic_metadata$prediction[89] <- ""
basic_metadata$prediction[90] <- "Y3POCL0TOB48OA23PP4X"
basic_metadata$prediction[91] <- "TUB8FKBT1F0HDJC4E5JJ"
basic_metadata$prediction[92] <- ""
basic_metadata$prediction[93] <- ""
basic_metadata$prediction[94] <- ""
basic_metadata$prediction[95] <- "TJ9DYTTIC1IEGOGDGKBG"
basic_metadata$prediction[96] <- "FWRUHOKDX83UY4CXPGKT"
basic_metadata$prediction[97] <- ""
basic_metadata$prediction[98] <- ""
basic_metadata$prediction[99] <- "8M9AGRKOW33JY9JC6P9E"
basic_metadata$prediction[100] <- ""
basic_metadata$prediction[101] <- ""
basic_metadata$prediction[102] <- ""
basic_metadata$prediction[103] <- ""
basic_metadata$prediction[104] <- ""
basic_metadata$prediction[105] <- ""
basic_metadata$prediction[106] <- ""
basic_metadata$prediction[107] <- ""
basic_metadata$prediction[108] <- ""
basic_metadata$prediction[109] <- ""
basic_metadata$prediction[110] <- ""
basic_metadata$prediction[111] <- "EJGRJWSOJBATCY9YF93R"
basic_metadata$prediction[112] <- ""
basic_metadata$prediction[113] <- ""
basic_metadata$prediction[114] <- ""
basic_metadata$prediction[115] <- "YYSH3K45WAXIY7EZHKIE"
basic_metadata$prediction[116] <- ""
basic_metadata$prediction[117] <- ""
basic_metadata$prediction[118] <- "AOSXW13N9RQZ7CRZ7MJS"
basic_metadata$prediction[119] <- "ZDPTZFSGG1ZQEOK4ORRB"
basic_metadata$prediction[120] <- ""
basic_metadata$prediction[121] <- ""
basic_metadata$prediction[122] <- ""
basic_metadata$prediction[123] <- "OPIB1TZHIT8QNYBZ1P9O"
basic_metadata$prediction[124] <- "H6I4HVYJH8DFEEPM4PCT"
basic_metadata$prediction[125] <- ""
basic_metadata$prediction[126] <- ""
basic_metadata$prediction[127] <- ""
basic_metadata$prediction[128] <- "XW8XLJ2K9O5V12LLT4Q9"
basic_metadata$prediction[129] <- "P299MVR0XGG51UWPSNKR"
basic_metadata$prediction[130] <- "0JOJRS92O0TPMJQDTNHC"
basic_metadata$prediction[131] <- ""
basic_metadata$prediction[132] <- ""
basic_metadata$prediction[133] <- ""
basic_metadata$prediction[134] <- ""
basic_metadata$prediction[135] <- ""
basic_metadata$prediction[136] <- ""
basic_metadata$prediction[137] <- ""
basic_metadata$prediction[138] <- ""
basic_metadata$prediction[139] <- ""
basic_metadata$prediction[140] <- ""
basic_metadata$prediction[141] <- ""
basic_metadata$prediction[142] <- ""
basic_metadata$prediction[143] <- ""
basic_metadata$prediction[144] <- ""
basic_metadata$prediction[145] <- ""
basic_metadata$prediction[146] <- ""
basic_metadata$prediction[147] <- ""
basic_metadata$prediction[148] <- "RS00DAAA04UVGG3WALGS"
basic_metadata$prediction[149] <- "A9N0QQ8IFFZ0Z89LYNFI"
basic_metadata$prediction[150] <- ""
basic_metadata$prediction[151] <- "K3ZC88XILS6Y9WPJWAUI"
basic_metadata$prediction[152] <- "WMDQP6JCDDU6U8LEWVZY"
basic_metadata$prediction[153] <- ""
basic_metadata$prediction[154] <- ""
basic_metadata$prediction[155] <- "6H2NCKWC0HFH00JGYY7R"
basic_metadata$prediction[156] <- ""
basic_metadata$prediction[157] <- "3XIVCTHI5M7QAWIS7UL0"
basic_metadata$prediction[158] <- "JO0G95ECU0SBO7N2QOVD"
basic_metadata$prediction[159] <- "LUS34SYEYV7H1CNKXF8M"
basic_metadata$prediction[160] <- ""
basic_metadata$prediction[161] <- "7F2PQX5LVC1XV9ZYTRR3"
basic_metadata$prediction[162] <- ""
basic_metadata$prediction[163] <- ""
basic_metadata$prediction[164] <- ""
basic_metadata$prediction[165] <- "0S8PT84E5DU0ZMX4OD91"
basic_metadata$prediction[166] <- "216PENQ5527G3YQ4Z4DE"
basic_metadata$prediction[167] <- "QMWHZO5E67APYHM3JL5M"
basic_metadata$prediction[168] <- ""
basic_metadata$prediction[169] <- ""
basic_metadata$prediction[170] <- ""
basic_metadata$prediction[171] <- "W10IQ4YD09M01A8WJOHP"
basic_metadata$prediction[172] <- ""
basic_metadata$prediction[173] <- ""
basic_metadata$prediction[174] <- ""
basic_metadata$prediction[175] <- "03IWB4JYRUE2LBPMN5X1"
basic_metadata$prediction[176] <- "E8G8V81FIYVERSUPKPJY"
basic_metadata$prediction[177] <- ""
basic_metadata$prediction[178] <- "1UPUX15HK586V8Q1DK4W"
basic_metadata$prediction[179] <- ""
basic_metadata$prediction[180] <- "PG8BUHZGV31HO9YMICWC"
basic_metadata$prediction[181] <- ""
basic_metadata$prediction[182] <- ""
basic_metadata$prediction[183] <- ""
basic_metadata$prediction[184] <- ""
basic_metadata$prediction[185] <- ""
basic_metadata$prediction[186] <- ""
basic_metadata$prediction[187] <- ""
basic_metadata$prediction[188] <- "YQYXB1LM2SNGPBTHHJ1D"
basic_metadata$prediction[189] <- ""
basic_metadata$prediction[190] <- ""
basic_metadata$prediction[191] <- ""
basic_metadata$prediction[192] <- ""
basic_metadata$prediction[193] <- ""
basic_metadata$prediction[194] <- "FJQSR2P1Y2T2XU5RK63T"
basic_metadata$prediction[195] <- ""
basic_metadata$prediction[196] <- ""
basic_metadata$prediction[197] <- ""
basic_metadata$prediction[198] <- ""
basic_metadata$prediction[199] <- "ZEA2Y4H4NX6JST0J3IY8"
basic_metadata$prediction[200] <- ""

basic_metadata$prediction[basic_metadata$prediction == ""] <- NA
  #+end_src


- So, let's get a basic idea of what the files look like with some plots:
  - [[file:~/playground/morse-project/plots/waveforms/initial/][Output Directory]]
  #+begin_src R :results silent
audio_files <- basic_metadata$filename
plot_waveforms(audio_files, "./plots/waveforms/initial")
  #+end_src

  #+begin_quote
Some, like [[file:~/playground/morse-project/plots/waveforms/initial/cw002.png][cw002]] and [[file:~/playground/morse-project/plots/waveforms/initial/cw003.png][cw003]] seem to be readable with no adjustments:
CW002: WRBCDGB5T1JNN63C3MR3
CW003: G1FNCKUDZ63TSIJ5QH47
  #+end_quote

- Boxplot of the durations:
  #+begin_src R :file ../plots/general/dur-box.png :results file graphics :width 600 :height 400
boxplot(x = basic_metadata$duration, main = "File Durations (s)")
  #+end_src

  #+RESULTS:
  [[file:../plots/general/dur-box.png]]

#+begin_quote
Remember, this is a graphical representation of what summary already says:
> summary(basic_metadata$duration)
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max.
  4.666   6.742   9.129  10.815  13.222  27.121

So, the files are typically no less than ~6-3/4 seconds in length, no more than ~13-1/4 seconds...
The skew shows that there are outlier files that are particularly long. The original dataset did mention that there was corruption in the initial upload, so that should be investigated.
#+end_quote

- Investigating long files outside Q3:
  #+begin_src R
q3 <- 13.222
above_q3 <- basic_metadata$duration > q3

basic_metadata[above_q3,]

nchar(basic_metadata$prediction[27])
  #+end_src

  #+RESULTS:
  #+begin_example
  filename samples duration sampleRate stereo  pcm bitdepth           prediction
  1   ./data/cw001.wav  139046   17.381       8000  FALSE TRUE       32                 <NA>
  6   ./data/cw006.wav  113453   14.182       8000  FALSE TRUE       32                 <NA>
  7   ./data/cw007.wav  167199   20.900       8000  FALSE TRUE       32                 <NA>
  12  ./data/cw012.wav  176165   22.021       8000  FALSE TRUE       32                 <NA>
  27  ./data/cw027.wav  162155   20.269       8000  FALSE TRUE       32 63BTNYH7OJ7XKBNYOV49
  31  ./data/cw031.wav  179885   22.486       8000  FALSE TRUE       32                 <NA>
  37  ./data/cw037.wav  180009   22.501       8000  FALSE TRUE       32 R2DX08BDJE46A0NU6ZT3
  38  ./data/cw038.wav  114227   14.278       8000  FALSE TRUE       32                 <NA>
  43  ./data/cw043.wav  112393   14.049       8000  FALSE TRUE       32                 <NA>
  47  ./data/cw047.wav  195784   24.473       8000  FALSE TRUE       32 EZRXQHXYJZ4AIZ15AFFM
  48  ./data/cw048.wav  154264   19.283       8000  FALSE TRUE       32                 <NA>
  49  ./data/cw049.wav  174930   21.866       8000  FALSE TRUE       32 GWII2VNNDB5U74ZPYUUC
  55  ./data/cw055.wav  113375   14.172       8000  FALSE TRUE       32                 <NA>
  60  ./data/cw060.wav  106961   13.370       8000  FALSE TRUE       32                 <NA>
  61  ./data/cw061.wav  152182   19.023       8000  FALSE TRUE       32                 <NA>
  66  ./data/cw066.wav  216967   27.121       8000  FALSE TRUE       32                 <NA>
  69  ./data/cw069.wav  114991   14.374       8000  FALSE TRUE       32                 <NA>
  78  ./data/cw078.wav  205753   25.719       8000  FALSE TRUE       32                 <NA>
  80  ./data/cw080.wav  165545   20.693       8000  FALSE TRUE       32                 <NA>
  84  ./data/cw084.wav  119448   14.931       8000  FALSE TRUE       32 VS7FCHNSK6UBYHBG7Q6A
  86  ./data/cw086.wav  109938   13.742       8000  FALSE TRUE       32                 <NA>
  88  ./data/cw088.wav  131960   16.495       8000  FALSE TRUE       32                 <NA>
  90  ./data/cw090.wav  209230   26.154       8000  FALSE TRUE       32 Y3POCL0TOB48OA23PP4X
  93  ./data/cw093.wav  114054   14.257       8000  FALSE TRUE       32                 <NA>
  97  ./data/cw097.wav  144100   18.012       8000  FALSE TRUE       32                 <NA>
  99  ./data/cw099.wav  194091   24.261       8000  FALSE TRUE       32 8M9AGRKOW33JY9JC6P9E
  104 ./data/cw104.wav  117379   14.672       8000  FALSE TRUE       32                 <NA>
  106 ./data/cw106.wav  143592   17.949       8000  FALSE TRUE       32                 <NA>
  110 ./data/cw110.wav  134996   16.875       8000  FALSE TRUE       32                 <NA>
  112 ./data/cw112.wav  201698   25.212       8000  FALSE TRUE       32                 <NA>
  114 ./data/cw114.wav  204649   25.581       8000  FALSE TRUE       32                 <NA>
  117 ./data/cw117.wav  140391   17.549       8000  FALSE TRUE       32                 <NA>
  118 ./data/cw118.wav  124486   15.561       8000  FALSE TRUE       32 AOSXW13N9RQZ7CRZ7MJS
  124 ./data/cw124.wav  199361   24.920       8000  FALSE TRUE       32 H6I4HVYJH8DFEEPM4PCT
  133 ./data/cw133.wav  129287   16.161       8000  FALSE TRUE       32                 <NA>
  136 ./data/cw136.wav  112389   14.049       8000  FALSE TRUE       32                 <NA>
  137 ./data/cw137.wav  181299   22.662       8000  FALSE TRUE       32                 <NA>
  139 ./data/cw139.wav  136007   17.001       8000  FALSE TRUE       32                 <NA>
  142 ./data/cw142.wav  136816   17.102       8000  FALSE TRUE       32                 <NA>
  160 ./data/cw160.wav  135047   16.881       8000  FALSE TRUE       32                 <NA>
  163 ./data/cw163.wav  130515   16.314       8000  FALSE TRUE       32                 <NA>
  164 ./data/cw164.wav  186423   23.303       8000  FALSE TRUE       32                 <NA>
  173 ./data/cw173.wav  171181   21.398       8000  FALSE TRUE       32                 <NA>
  175 ./data/cw175.wav  116567   14.571       8000  FALSE TRUE       32 03IWB4JYRUE2LBPMN5X1
  178 ./data/cw178.wav  107099   13.387       8000  FALSE TRUE       32 1UPUX15HK586V8Q1DK4W
  182 ./data/cw182.wav  113137   14.142       8000  FALSE TRUE       32                 <NA>
  184 ./data/cw184.wav  125844   15.730       8000  FALSE TRUE       32                 <NA>
  189 ./data/cw189.wav  135035   16.879       8000  FALSE TRUE       32                 <NA>
  194 ./data/cw194.wav  106076   13.259       8000  FALSE TRUE       32 FJQSR2P1Y2T2XU5RK63T
  195 ./data/cw195.wav  131475   16.434       8000  FALSE TRUE       32                 <NA>
  [1] 20
  #+end_example

#+begin_quote
Actually, I do see a pattern now that the data is visualized and in a table...
Conveniently for us, every message seems to contain 20 characters. That means that we can get a good estimate of
the words per minute for each file with no extra effort!! Perfect for training a model...
#+end_quote
